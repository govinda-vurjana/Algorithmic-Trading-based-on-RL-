You are given a broken data preprocessing pipeline for a machine learning project. 

The pipeline should:
1. Load a CSV dataset with mixed data types
2. Handle missing values appropriately 
3. Encode categorical variables correctly
4. Normalize/standardize numerical features
5. Split data into train/test sets without data leakage
6. Return clean, ML-ready data splits

TASK: Fix the broken preprocessing pipeline

REQUIREMENTS:
1. Fix all bugs in the preprocessing code
2. Ensure no data leakage (normalize AFTER train/test split)
3. Handle missing values appropriately for different data types
4. Use proper encoding for categorical variables (OneHotEncoder for non-ordinal)
5. Add input validation and error handling
6. Ensure the output has no missing or infinite values
7. Use stratified sampling to preserve target distribution

AVAILABLE TOOLS:
- python_expression: Execute Python code
- file_reader: Read files from the data directory
- dataset_download: Download datasets from URLs (if needed)
- submit_answer: Submit your corrected preprocessing function

IMPORTANT CODING GUIDELINES:
- Use df[col] = df[col].fillna(value) instead of inplace=True
- Use OneHotEncoder(sparse_output=False) for newer sklearn versions
- Use OneHotEncoder(drop='first') to avoid multicollinearity
- Always split data BEFORE any preprocessing to avoid data leakage

SUBMISSION FORMAT:
You MUST submit your solution using the submit_answer tool with your corrected preprocess_data() function.

Example:
submit_answer(answer="def preprocess_data(filepath, target_column, test_size=0.2, random_state=42):\n    # your code here\n    return X_train, X_test, y_train, y_test")

The function should successfully process the sample dataset and pass all validation checks.